CREATE TABLE IF NOT EXISTS team (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name VARCHAR(255) NOT NULL UNIQUE,
  points INTEGER NOT NULL DEFAULT 0,
  total_match INTEGER NOT NULL DEFAULT 0,
  wins INTEGER NOT NULL DEFAULT 0,
  draws INTEGER NOT NULL DEFAULT 0,
  losses INTEGER NOT NULL DEFAULT 0,
  goals_for INTEGER NOT NULL DEFAULT 0,
  goals_against INTEGER NOT NULL DEFAULT 0
);


CREATE TABLE IF NOT EXISTS matches (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  home_team_id BIGINT NOT NULL REFERENCES team(id) ON DELETE RESTRICT,
  away_team_id BIGINT NOT NULL REFERENCES team(id) ON DELETE RESTRICT,
  match_date TIMESTAMPTZ NOT NULL,
  week INTEGER NOT NULL,
  home_goals INTEGER NOT NULL DEFAULT 0,
  away_goals INTEGER NOT NULL DEFAULT 0,
  CONSTRAINT chk_goals_nonneg CHECK (home_goals >= 0 AND away_goals >= 0),
  CONSTRAINT chk_teams_different CHECK (home_team_id <> away_team_id)
);


CREATE INDEX IF NOT EXISTS idx_match_week ON matches(week);
CREATE INDEX IF NOT EXISTS idx_match_date ON matches(match_date);
CREATE INDEX IF NOT EXISTS idx_team_name ON team(name);
